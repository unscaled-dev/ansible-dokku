---
# Configure SSL/TLS for a Dokku app using Let's Encrypt
# Required: dokku_app.name, dokku_app.email, dokku_app.domains
#
# This file is NOT part of upstream ansible-dokku.
# It uses the dokku modules from this role's library/ directory.

- name: Set Let's Encrypt email
  ansible.builtin.command: dokku letsencrypt:set {{ dokku_app.name }} email {{ dokku_app.email }}
  when:
    - dokku_app.ssl | default(false)
    - dokku_app.email is defined
  changed_when: true

- name: Enable SSL with Let's Encrypt
  dokku_letsencrypt:
    app: "{{ dokku_app.name }}"
  when:
    - dokku_app.domains is defined
    - dokku_app.ssl | default(false)
